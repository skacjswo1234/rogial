<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¡œì§€ì•Œ ê´€ë¦¬ì í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
            },
            accent: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
          },
          boxShadow: {
            glow: '0 10px 50px rgba(249, 115, 22, 0.25)',
            glowBlue: '0 10px 50px rgba(59, 130, 246, 0.25)',
          },
        },
      },
    };
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .text-gradient {
      background: linear-gradient(120deg, #f97316, #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .mobile-sidebar {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }
    .mobile-sidebar.open {
      transform: translateX(0);
    }
    .mobile-overlay {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    .mobile-overlay.show {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ -->
  <div id="mobile-overlay" class="mobile-overlay fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden" onclick="closeMobileSidebar()"></div>

  <!-- ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ìƒë‹¨) -->
  <button id="mobile-menu-btn" onclick="toggleMobileSidebar()" class="md:hidden fixed top-4 right-4 z-50 w-12 h-12 flex items-center justify-center rounded-full bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-glow hover:shadow-xl transition-all">
    <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
    <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <div class="flex h-screen overflow-hidden">
    <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” (íƒ­) - ë°ìŠ¤í¬í†± -->
    <aside class="hidden md:flex w-64 bg-white border-r border-gray-200 flex flex-col shadow-lg">
      <div class="p-6 border-b border-gray-200 bg-gradient-to-br from-primary-50 to-accent-50">
        <div class="flex items-center space-x-3 mb-3">
          <div class="w-12 h-12 rounded-full overflow-hidden shadow-glow flex items-center justify-center bg-white">
            <img src="./logo.PNG" alt="ë¡œì§€ì•Œ ë¡œê³ " class="w-full h-full object-contain" />
          </div>
          <h1 class="text-xl font-black text-gradient">ì£¼ì‹íšŒì‚¬ ë¡œì§€ì•Œ</h1>
        </div>
        <p class="text-sm text-gray-600 font-semibold">ë¬¸ì˜ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
      </div>
      
      <nav class="flex-1 p-4 space-y-2">
        <button 
          onclick="loadTab('all'); closeMobileSidebar();" 
          id="tab-all"
          class="w-full text-left px-4 py-3 rounded-lg bg-primary-50 text-primary-700 font-semibold border border-primary-200 transition-all hover:shadow-md">
          ğŸ“‹ ì „ì²´ ë¬¸ì˜
        </button>
        <button 
          onclick="loadTab('pending'); closeMobileSidebar();" 
          id="tab-pending"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-all border border-transparent hover:border-primary-200">
          â³ ëŒ€ê¸° ì¤‘
        </button>
        <button 
          onclick="loadTab('contacted'); closeMobileSidebar();" 
          id="tab-contacted"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-accent-50 hover:text-accent-600 transition-all border border-transparent hover:border-accent-200">
          ğŸ“ ì—°ë½ ì™„ë£Œ
        </button>
        <button 
          onclick="loadTab('processing'); closeMobileSidebar();" 
          id="tab-processing"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-all border border-transparent hover:border-primary-200">
          ğŸ”„ ì§„í–‰ ì¤‘
        </button>
        <button 
          onclick="loadTab('completed'); closeMobileSidebar();" 
          id="tab-completed"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 transition-all border border-transparent hover:border-green-200">
          âœ… ì™„ë£Œ
        </button>
        <button 
          onclick="loadTab('cancelled'); closeMobileSidebar();" 
          id="tab-cancelled"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition-all border border-transparent hover:border-red-200">
          âŒ ì·¨ì†Œ
        </button>
      </nav>

      <div class="p-4 border-t border-gray-200 bg-gradient-to-br from-gray-50 to-white">
        <button 
          onclick="refreshData()" 
          class="w-full px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-lg font-semibold hover:shadow-glow transition-all hover:scale-[1.02]">
          ğŸ”„ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>
    </aside>

    <!-- ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” (ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ) -->
    <aside id="mobile-sidebar" class="mobile-sidebar fixed top-0 right-0 w-64 h-full bg-white shadow-2xl z-50 flex flex-col md:hidden">
      <div class="p-6 border-b border-gray-200 bg-gradient-to-br from-primary-50 to-accent-50">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center space-x-3 flex-1">
            <div class="w-12 h-12 rounded-full overflow-hidden shadow-glow flex items-center justify-center bg-white">
              <img src="./logo.PNG" alt="ë¡œì§€ì•Œ ë¡œê³ " class="w-full h-full object-contain" />
            </div>
            <h1 class="text-xl font-black text-gradient">ì£¼ì‹íšŒì‚¬ ë¡œì§€ì•Œ</h1>
          </div>
          <button onclick="closeMobileSidebar()" class="w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-md hover:shadow-lg transition-all">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <p class="text-sm text-gray-600 font-semibold">ë¬¸ì˜ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
      </div>
      
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
        <button 
          onclick="loadTab('all'); closeMobileSidebar();" 
          id="mobile-tab-all"
          class="w-full text-left px-4 py-3 rounded-lg bg-primary-50 text-primary-700 font-semibold border border-primary-200 transition-all">
          ğŸ“‹ ì „ì²´ ë¬¸ì˜
        </button>
        <button 
          onclick="loadTab('pending'); closeMobileSidebar();" 
          id="mobile-tab-pending"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-all border border-transparent hover:border-primary-200">
          â³ ëŒ€ê¸° ì¤‘
        </button>
        <button 
          onclick="loadTab('contacted'); closeMobileSidebar();" 
          id="mobile-tab-contacted"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-accent-50 hover:text-accent-600 transition-all border border-transparent hover:border-accent-200">
          ğŸ“ ì—°ë½ ì™„ë£Œ
        </button>
        <button 
          onclick="loadTab('processing'); closeMobileSidebar();" 
          id="mobile-tab-processing"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-primary-50 hover:text-primary-600 transition-all border border-transparent hover:border-primary-200">
          ğŸ”„ ì§„í–‰ ì¤‘
        </button>
        <button 
          onclick="loadTab('completed'); closeMobileSidebar();" 
          id="mobile-tab-completed"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-green-50 hover:text-green-600 transition-all border border-transparent hover:border-green-200">
          âœ… ì™„ë£Œ
        </button>
        <button 
          onclick="loadTab('cancelled'); closeMobileSidebar();" 
          id="mobile-tab-cancelled"
          class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-red-50 hover:text-red-600 transition-all border border-transparent hover:border-red-200">
          âŒ ì·¨ì†Œ
        </button>
      </nav>

      <div class="p-4 border-t border-gray-200 bg-gradient-to-br from-gray-50 to-white">
        <button 
          onclick="refreshData()" 
          class="w-full px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-lg font-semibold hover:shadow-glow transition-all hover:scale-[1.02]">
          ğŸ”„ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>
    </aside>

    <!-- ì˜¤ë¥¸ìª½ ì½˜í…ì¸  ì˜ì—­ -->
    <main class="flex-1 overflow-y-auto">
      <div class="p-4 md:p-6">
        <!-- í—¤ë” -->
        <div class="mb-6 pt-4 md:pt-0">
          <h2 id="content-title" class="text-2xl md:text-3xl font-black text-gray-900">ì „ì²´ ë¬¸ì˜</h2>
          <p id="content-subtitle" class="text-gray-600 mt-1 font-semibold">ëª¨ë“  ë¬¸ì˜ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div id="stats" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
          <!-- í†µê³„ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <div class="bg-white rounded-xl shadow-lg border-2 border-primary-100 p-4 mb-6">
          <div class="flex flex-col md:flex-row gap-4">
            <input 
              type="text" 
              id="search-input"
              placeholder="ì´ë¦„, ì—°ë½ì²˜, ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰..." 
              class="flex-1 px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"
              onkeyup="handleSearch(event)"
            />
            <select 
              id="work-type-filter"
              class="px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all"
              onchange="applyFilters()"
            >
              <option value="">ëª¨ë“  ì‘ì—… ì¢…ë¥˜</option>
              <option value="ì¥ë‚œê°ë¶€í’ˆë²„í´ìº¡">ğŸ§¸ ì¥ë‚œê° ë¶€í’ˆ ë²„í´ìº¡</option>
              <option value="í°ì¼€ì´ìŠ¤ìŠ¤í‹°ì»¤">ğŸ“± í°ì¼€ì´ìŠ¤ ìŠ¤í‹°ì»¤</option>
              <option value="ë‹¨ì¶”ë¶€ìì¬">âšª ë‹¨ì¶”ë¶€ìì¬</option>
              <option value="ë¨¸ë¦¬í•€">ğŸ€ ë¨¸ë¦¬í•€</option>
              <option value="ì»¤ë„¥í„°">ğŸ¦‹ ì»¤ë„¥í„°</option>
              <option value="ê½ƒê½‚ì´">ğŸŒ¸ ê½ƒê½‚ì´</option>
              <option value="ì—´ì‡ ê³ ë¦¬">ğŸ” ì—´ì‡ ê³ ë¦¬</option>
              <option value="ìŠ¤í‹°ì»¤">ğŸŒˆ ìŠ¤í‹°ì»¤</option>
            </select>
          </div>
        </div>

        <!-- ë¬¸ì˜ ëª©ë¡ -->
        <div id="inquiries-list" class="space-y-4">
          <!-- ë¬¸ì˜ ëª©ë¡ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
          <div class="text-center py-12 text-gray-500">
            ë¡œë”© ì¤‘...
          </div>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="pagination" class="mt-6 flex justify-center">
          <!-- í˜ì´ì§€ë„¤ì´ì…˜ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
      </div>
    </main>
  </div>

  <!-- ë¬¸ì˜ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border-2 border-primary-100">
      <div class="p-6">
        <div class="flex justify-between items-start mb-4">
          <h3 class="text-2xl font-black text-gray-900">ë¬¸ì˜ ìƒì„¸</h3>
          <button onclick="closeDetailModal()" class="text-gray-400 hover:text-primary-500 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div id="detail-content" class="space-y-4">
          <!-- ìƒì„¸ ë‚´ìš©ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'all';
    let currentPage = 1;
    let allInquiries = [];

    const statusLabels = {
      'pending': 'â³ ëŒ€ê¸° ì¤‘',
      'contacted': 'ğŸ“ ì—°ë½ ì™„ë£Œ',
      'processing': 'ğŸ”„ ì§„í–‰ ì¤‘',
      'completed': 'âœ… ì™„ë£Œ',
      'cancelled': 'âŒ ì·¨ì†Œ'
    };

    const statusColors = {
      'pending': 'bg-yellow-100 text-yellow-800',
      'contacted': 'bg-blue-100 text-blue-800',
      'processing': 'bg-purple-100 text-purple-800',
      'completed': 'bg-green-100 text-green-800',
      'cancelled': 'bg-red-100 text-red-800'
    };

    // íƒ­ ë¡œë“œ
    function loadTab(status) {
      currentTab = status;
      currentPage = 1;
      
      // íƒ­ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
      document.querySelectorAll('nav button').forEach(btn => {
        btn.classList.remove('bg-primary-50', 'text-primary-700', 'border-primary-200', 'font-semibold');
        btn.classList.add('text-gray-700', 'hover:bg-gray-50');
      });
      
      const tabId = status === 'all' ? 'tab-all' : `tab-${status}`;
      const activeTab = document.getElementById(tabId);
      if (activeTab) {
        activeTab.classList.add('bg-primary-50', 'text-primary-700', 'border', 'border-primary-200', 'font-semibold');
        activeTab.classList.remove('text-gray-700', 'hover:bg-gray-50');
      }

      // ëª¨ë°”ì¼ íƒ­ë„ ì—…ë°ì´íŠ¸
      const mobileTabId = status === 'all' ? 'mobile-tab-all' : `mobile-tab-${status}`;
      const mobileActiveTab = document.getElementById(mobileTabId);
      if (mobileActiveTab) {
        // ëª¨ë“  ëª¨ë°”ì¼ íƒ­ ì´ˆê¸°í™”
        document.querySelectorAll('[id^="mobile-tab-"]').forEach(btn => {
          btn.classList.remove('bg-primary-50', 'text-primary-700', 'border-primary-200', 'font-semibold');
          btn.classList.add('text-gray-700');
        });
        mobileActiveTab.classList.add('bg-primary-50', 'text-primary-700', 'border', 'border-primary-200', 'font-semibold');
        mobileActiveTab.classList.remove('text-gray-700');
      }

      // ì œëª© ì—…ë°ì´íŠ¸
      const titles = {
        'all': 'ì „ì²´ ë¬¸ì˜',
        'pending': 'ëŒ€ê¸° ì¤‘ì¸ ë¬¸ì˜',
        'contacted': 'ì—°ë½ ì™„ë£Œëœ ë¬¸ì˜',
        'processing': 'ì§„í–‰ ì¤‘ì¸ ë¬¸ì˜',
        'completed': 'ì™„ë£Œëœ ë¬¸ì˜',
        'cancelled': 'ì·¨ì†Œëœ ë¬¸ì˜'
      };
      document.getElementById('content-title').textContent = titles[status] || 'ì „ì²´ ë¬¸ì˜';
      document.getElementById('content-subtitle').textContent = `${titles[status]} ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

      loadInquiries();
    }

    // ë¬¸ì˜ ëª©ë¡ ë¡œë“œ
    async function loadInquiries() {
      try {
        const status = currentTab === 'all' ? '' : currentTab;
        const url = `/api/inquiries?status=${status}&page=${currentPage}&limit=20`;
        
        const response = await fetch(url);
        const result = await response.json();

        if (result.success) {
          allInquiries = result.data;
          renderInquiries(result.data);
          renderPagination(result.pagination);
          loadStats();
        } else {
          console.error('ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', result.error);
        }
      } catch (error) {
        console.error('ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('inquiries-list').innerHTML = 
          '<div class="text-center py-12 text-red-500">ë¬¸ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }

    // í†µê³„ ë¡œë“œ
    async function loadStats() {
      try {
        const statuses = ['pending', 'contacted', 'processing', 'completed', 'cancelled'];
        const stats = {};

        for (const status of statuses) {
          const response = await fetch(`/api/inquiries?status=${status}`);
          const result = await response.json();
          stats[status] = result.pagination?.total || 0;
        }

        const total = Object.values(stats).reduce((a, b) => a + b, 0);
        stats.total = total;

        renderStats(stats);
      } catch (error) {
        console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // í†µê³„ ë Œë”ë§
    function renderStats(stats) {
      const statsHtml = `
        <div class="bg-gradient-to-br from-white to-primary-50 rounded-xl shadow-lg border-2 border-primary-200 p-4">
          <div class="text-sm text-gray-600 font-semibold">ì „ì²´</div>
          <div class="text-2xl font-black text-primary-600">${stats.total}</div>
        </div>
        <div class="bg-gradient-to-br from-white to-yellow-50 rounded-xl shadow-lg border-2 border-yellow-200 p-4">
          <div class="text-sm text-gray-600 font-semibold">ëŒ€ê¸° ì¤‘</div>
          <div class="text-2xl font-black text-yellow-600">${stats.pending}</div>
        </div>
        <div class="bg-gradient-to-br from-white to-accent-50 rounded-xl shadow-lg border-2 border-accent-200 p-4">
          <div class="text-sm text-gray-600 font-semibold">ì—°ë½ ì™„ë£Œ</div>
          <div class="text-2xl font-black text-accent-600">${stats.contacted}</div>
        </div>
        <div class="bg-gradient-to-br from-white to-primary-50 rounded-xl shadow-lg border-2 border-primary-200 p-4">
          <div class="text-sm text-gray-600 font-semibold">ì§„í–‰ ì¤‘</div>
          <div class="text-2xl font-black text-primary-600">${stats.processing}</div>
        </div>
        <div class="bg-gradient-to-br from-white to-green-50 rounded-xl shadow-lg border-2 border-green-200 p-4">
          <div class="text-sm text-gray-600 font-semibold">ì™„ë£Œ</div>
          <div class="text-2xl font-black text-green-600">${stats.completed}</div>
        </div>
      `;
      document.getElementById('stats').innerHTML = statsHtml;
    }

    // ë¬¸ì˜ ëª©ë¡ ë Œë”ë§
    function renderInquiries(inquiries) {
      if (inquiries.length === 0) {
        document.getElementById('inquiries-list').innerHTML = 
          '<div class="text-center py-12 text-gray-500">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      const listHtml = inquiries.map(inquiry => `
        <div class="bg-white rounded-xl shadow-lg border-2 border-gray-200 p-4 md:p-6 hover:shadow-xl hover:border-primary-300 transition-all cursor-pointer" onclick="showDetail(${inquiry.id})">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h3 class="text-lg font-black text-gray-900">${escapeHtml(inquiry.name)}</h3>
              <p class="text-sm text-gray-600 mt-1 font-semibold">${escapeHtml(inquiry.phone)}</p>
            </div>
            <span class="px-3 py-1 rounded-full text-sm font-bold ${statusColors[inquiry.status] || 'bg-gray-100 text-gray-800'}">
              ${statusLabels[inquiry.status] || inquiry.status}
            </span>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
              <div class="text-gray-600">ì§€ì—­</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.region)}</div>
            </div>
            <div>
              <div class="text-gray-600">ì‘ì—… ì¢…ë¥˜</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.work_type)}</div>
            </div>
            <div>
              <div class="text-gray-600">ìµœì†Œ ìˆ˜ëŸ‰</div>
              <div class="font-semibold text-gray-900">${inquiry.min_quantity ? inquiry.min_quantity.toLocaleString() + 'ê°œ' : '-'}</div>
            </div>
            <div>
              <div class="text-gray-600">ë“±ë¡ì¼</div>
              <div class="font-semibold text-gray-900">${formatDate(inquiry.created_at)}</div>
            </div>
          </div>
        </div>
      `).join('');

      document.getElementById('inquiries-list').innerHTML = listHtml;
    }

    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function renderPagination(pagination) {
      if (pagination.totalPages <= 1) {
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      let paginationHtml = '<div class="flex gap-2">';
      
      // ì´ì „ í˜ì´ì§€
      if (pagination.page > 1) {
        paginationHtml += `
          <button onclick="changePage(${pagination.page - 1})" 
            class="px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-primary-50 hover:border-primary-300 transition-all font-semibold">
            ì´ì „
          </button>
        `;
      }

      // í˜ì´ì§€ ë²ˆí˜¸
      for (let i = 1; i <= pagination.totalPages; i++) {
        if (i === pagination.page) {
          paginationHtml += `
            <button class="px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-lg font-bold shadow-glow">
              ${i}
            </button>
          `;
        } else {
          paginationHtml += `
            <button onclick="changePage(${i})" 
              class="px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-primary-50 hover:border-primary-300 transition-all font-semibold">
              ${i}
            </button>
          `;
        }
      }

      // ë‹¤ìŒ í˜ì´ì§€
      if (pagination.page < pagination.totalPages) {
        paginationHtml += `
          <button onclick="changePage(${pagination.page + 1})" 
            class="px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-primary-50 hover:border-primary-300 transition-all font-semibold">
            ë‹¤ìŒ
          </button>
        `;
      }

      paginationHtml += '</div>';
      document.getElementById('pagination').innerHTML = paginationHtml;
    }

    // í˜ì´ì§€ ë³€ê²½
    function changePage(page) {
      currentPage = page;
      loadInquiries();
    }

    // ë¬¸ì˜ ìƒì„¸ ë³´ê¸°
    async function showDetail(id) {
      try {
        const response = await fetch(`/api/inquiries/${id}`);
        const result = await response.json();

        if (result.success) {
          renderDetail(result.data);
          document.getElementById('detail-modal').classList.remove('hidden');
        }
      } catch (error) {
        console.error('ë¬¸ì˜ ìƒì„¸ ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ë¬¸ì˜ ìƒì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ë¬¸ì˜ ìƒì„¸ ë Œë”ë§
    function renderDetail(inquiry) {
      const detailHtml = `
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="text-sm text-gray-600">ì´ë¦„</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.name)}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ì—°ë½ì²˜</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.phone)}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ì§€ì—­</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.region)}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ì‘ì—… ì¢…ë¥˜</div>
              <div class="font-semibold text-gray-900">${escapeHtml(inquiry.work_type)}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ìµœì†Œ ìˆ˜ëŸ‰</div>
              <div class="font-semibold text-gray-900">${inquiry.min_quantity ? inquiry.min_quantity.toLocaleString() + 'ê°œ' : '-'}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ìƒíƒœ</div>
              <span class="px-3 py-1 rounded-full text-sm font-semibold ${statusColors[inquiry.status] || 'bg-gray-100 text-gray-800'}">
                ${statusLabels[inquiry.status] || inquiry.status}
              </span>
            </div>
            <div>
              <div class="text-sm text-gray-600">ë“±ë¡ì¼</div>
              <div class="font-semibold text-gray-900">${formatDate(inquiry.created_at)}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">ìˆ˜ì •ì¼</div>
              <div class="font-semibold text-gray-900">${inquiry.updated_at ? formatDate(inquiry.updated_at) : '-'}</div>
            </div>
          </div>
          ${inquiry.message ? `
            <div>
              <div class="text-sm text-gray-600 mb-2">ë¬¸ì˜ ë‚´ìš©</div>
              <div class="p-4 bg-gray-50 rounded-lg text-gray-900 whitespace-pre-wrap">${escapeHtml(inquiry.message)}</div>
            </div>
          ` : ''}
          ${inquiry.notes ? `
            <div>
              <div class="text-sm text-gray-600 mb-2">ë©”ëª¨</div>
              <div class="p-4 bg-gray-50 rounded-lg text-gray-900 whitespace-pre-wrap">${escapeHtml(inquiry.notes)}</div>
            </div>
          ` : ''}
          <div class="pt-4 border-t border-gray-200">
            <div class="text-sm text-gray-600 mb-2">ìƒíƒœ ë³€ê²½</div>
            <div class="flex gap-2 flex-wrap">
              ${Object.entries(statusLabels).map(([status, label]) => `
                <button 
                  onclick="updateStatus(${inquiry.id}, '${status}')"
                  class="px-4 py-2 rounded-lg border-2 transition-all hover:shadow-md ${inquiry.status === status ? 'bg-primary-50 border-primary-300 text-primary-700 font-bold' : 'border-gray-300 hover:bg-gray-50'}">
                  ${label}
                </button>
              `).join('')}
            </div>
          </div>
          <div class="pt-4 border-t border-gray-200">
            <button 
              onclick="deleteInquiry(${inquiry.id})"
              class="px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:shadow-lg font-bold transition-all hover:scale-[1.02]">
              ì‚­ì œ
            </button>
          </div>
        </div>
      `;
      document.getElementById('detail-content').innerHTML = detailHtml;
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    async function updateStatus(id, status) {
      try {
        const response = await fetch(`/api/inquiries/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status })
        });

        const result = await response.json();

        if (result.success) {
          closeDetailModal();
          loadInquiries();
          loadStats();
        } else {
          alert('ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ' + result.error);
        }
      } catch (error) {
        console.error('ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        alert('ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ë¬¸ì˜ ì‚­ì œ
    async function deleteInquiry(id) {
      if (!confirm('ì •ë§ ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        const response = await fetch(`/api/inquiries/${id}`, {
          method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
          closeDetailModal();
          loadInquiries();
          loadStats();
        } else {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.error);
        }
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeDetailModal() {
      document.getElementById('detail-modal').classList.add('hidden');
    }

    // ê²€ìƒ‰ ì²˜ë¦¬
    function handleSearch(event) {
      if (event.key === 'Enter') {
        applyFilters();
      }
    }

    // í•„í„° ì ìš©
    function applyFilters() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const workType = document.getElementById('work-type-filter').value;

      let filtered = allInquiries;

      if (searchTerm) {
        filtered = filtered.filter(inquiry => 
          inquiry.name.toLowerCase().includes(searchTerm) ||
          inquiry.phone.includes(searchTerm) ||
          inquiry.region.toLowerCase().includes(searchTerm)
        );
      }

      if (workType) {
        filtered = filtered.filter(inquiry => inquiry.work_type === workType);
      }

      renderInquiries(filtered);
    }

    // ìƒˆë¡œê³ ì¹¨
    function refreshData() {
      loadInquiries();
      loadStats();
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í† ê¸€
    function toggleMobileSidebar() {
      const sidebar = document.getElementById('mobile-sidebar');
      const overlay = document.getElementById('mobile-overlay');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');
      
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
      
      if (sidebar.classList.contains('open')) {
        menuIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
      } else {
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
      }
    }

    // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” ë‹«ê¸°
    function closeMobileSidebar() {
      const sidebar = document.getElementById('mobile-sidebar');
      const overlay = document.getElementById('mobile-overlay');
      const menuIcon = document.getElementById('menu-icon');
      const closeIcon = document.getElementById('close-icon');
      
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
      menuIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
    }

    // ì´ˆê¸° ë¡œë“œ
    loadTab('all');
  </script>
</body>
</html>

